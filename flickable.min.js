// Flickable 0.0.2 Copyright (C) 2013 @yuya, MIT License.
!function(a,b,c){function d(a){var b=Object.prototype.toString.call(a);return"[object NodeList]"===b||"[object HTMLCollection]"===b}function e(a,b){for(var c=0,d=a.length;d;c++,d--)b.call(a[c],a[c])}function f(a){for(var b=[],c=Object.keys(a),d=0,e=c.length;e;d++,e--)b.push(c[d]);return b}function g(a){var c,e,f=/^(.+[\#\.\s\[\*>:,]|[\[:])/;return"string"==typeof a?(e=a.substring(1,a.length),c=f.test(a)?b.querySelector(a):"#"===a[0]?b.getElementById(e):"."===a[0]?b.getElementsByClassName(e)[0]:b.getElementsByTagName(a)[0]):c=d(a)||"object"==typeof a&&a.length||Array.isArray(a)&&a.length&&a[0].nodeType?a[0]:a,c}function h(a){var b;return a instanceof Array?(b=!1,e(a,function(a){y.style[a]!==c&&(b=!0)}),b):"string"==typeof a?y.style[a]!==c?!0:!1:void 0}function i(a,b){function d(a,b,d){var f=A[b];f?a[f]=d:a[b]!==c?(A[b]=b,a[b]=d):e(z,function(e){var f=u(e)+u(b);a[f]!==c&&(A[b]=f,a[f]=d)})}var g=a.style,h=f(b);!function(a,c){for(;c;a++,c--)d(g,h[a],b[h[a]])}(0,h.length)}function j(a){return B.transform3d?"translate3d("+a+"px, 0, 0)":"translate("+a+"px, 0)"}function k(a,b){return a.changedTouches?a.changedTouches[0][b]:a[b]}function l(a){var b=null;return y.style[a]!==c?a:(e(z,function(d){var e=u(d)+u(a);y.style[e]!==c&&(b="-"+d+a)}),b)}function m(a,b){var c=[],d=a.childNodes;return A.childElement||(e(d,function(a){1===a.nodeType&&c.push(a)}),A.childElement=c),b?b():A.childElement}function n(a){return a.firstElementChild?a.firstElementChild:m(a,function(){return A.childElement[0]})}function o(a){return a.childElementCount?a.childElementCount:m(a,function(){return A.childElement.length})}function p(b,c,d){function f(a){var b=0;return e(a,function(a){var c=i[v(a)];c&&(b+=/\d/.test(c)?parseFloat(c.match(/\d+/)[0]):0)}),b}c=c||!1,d=d||"offsetWidth";var g,h,i=b.currentStyle||a.getComputedStyle(b,null);return g=f(["margin-right","margin-left"]),h=b[d]+g}function q(){var a=["webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","transitionend"],b="msie"!==C.browser?C.browser:C.version.browser>10?"oldie":"ie";switch(b){case"webkit":return[a[0],a[3]];case"firefox":return[a[1],a[3]];case"opera":return[a[2],a[3]];case"ie":return[a[3]];default:return[]}}function r(a,b,c,d){return d=d||!1,B.addEventListener?a.addEventListener(b,c,d):a.attachEvent("on"+b,c)}function s(a,b,c,d){return d=d||!1,B.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent("on"+b,c)}function t(a,c,d,e){var f;B.createEvent?(f=b.createEvent("Event"),f.initEvent(c,d,e),a.dispatchEvent(f)):(f=b.createEventObject(),a.fireEvent(c,f))}function u(a){return a[0].toUpperCase()+a.substring(1,a.length)}function v(a){return a.replace(/-[a-z]/gi,function(a){return a[1].toUpperCase()})}b.getElementsByClassName||(b.getElementsByClassName=function(a){return b.querySelectorAll("."+a)}),Object.keys||(Object.keys=function(a){var b,c=[],d=0;for(b in a)a.hasOwnProperty(b)&&(c[d++]=b);return c}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)});var w,x="Flickable",y=b.createElement("div"),z=["webkit","moz","o","ms"],A={},B=function(){var c=h(["perspectiveProperty","WebkitPerspective","MozPerspective","msPerspective","OPerspective"]),d=h(["transformProperty","WebkitTransform","MozTransform","msTransform","OTransform"]),e=h(["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","msTransitionProperty","OTransitionProperty"]);return{touchEvent:"ontouchstart"in a,addEventListener:"addEventListener"in a,removeEventListener:"removeEventListener"in a,orientationchange:"onorientationchange"in a,createEvent:"createEvent"in b,transform3d:c,transform:d,cssAnimation:(c||d)&&e?!0:!1}}(),C=function(){var a=navigator.userAgent.toLowerCase(),b=a.match(/(?:iphone\sos|ip[oa]d.*os)\s([\d_]+)/),c=a.match(/(android)\s+([\d.]+)/),d=!!b,e=!!c,f=function(){var b=/(webkit)[ \/]([\w.]+)/.exec(a)||/(firefox)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||[];return{name:b[1],version:parseFloat(b[2])}}(),g=function(){return B.touchEvent&&(d||e)?d?"ios":"android":"desktop"}(),h=function(){return"desktop"!==g?parseFloat((b||c).pop().split(/\D/).join(".")):null}();return{platform:g,browser:f.name,version:{os:h,browser:f.version},isLegacy:e&&4>h||"msie"===f.name&&f.version<10}}(),D=B.touchEvent?"touchstart":"mousedown",E=B.touchEvent?"touchmove":"mousemove",F=B.touchEvent?"touchend":"mouseup",G=B.orientationchange?"orientationchange":"resize";w=function(){function a(a,b,c){var d,e=this;this.el=g(a),this.opts=b||{},this.opts.setWidth=this.opts.setWidth||!1,this.opts.autoPlay=this.opts.autoPlay||!1,this.opts.loop=this.opts.loop||(this.opts.autoPlay?!0:!1),this.opts.interval=this.opts.interval||6600,this.opts.clearInterval=this.opts.clearInterval||this.opts.interval/2,this.opts.disableTouch=this.opts.disableTouch||!1,this.opts.transition=this.opts.transition||{duration:C.isLegacy?"200ms":"330ms",timingFunction:"cubic-bezier(0.23, 1, 0.32, 1)"},this.maxX=this.currentX=this.startPageX=this.startPageY=this.basePageX=this.directionX=this.visibleSize=0,this.timeId=null,this.currentPoint=this.opts.defaultPoint||0,this.beforeChildElementCount=o(this.el),this.afterChildElementCount=this.beforeChildElementCount,this.scrolling=this.moveReady=this.useJsAnimate=!1,d=B.cssAnimation&&!C.isLegacy?{transitionProperty:l("transform"),transitionDuration:"0ms",transitionTimingFunction:this.opts.transition.timingFunction,transform:j(0)}:B.cssAnimation&&C.isLegacy?{position:"relative",left:"0px",transitionProperty:"left",transitionDuration:"0ms",transitionTimingFunction:this.opts.transition.timingFunction}:{position:"relative",left:"0px"},i(this.el,d),r(this.el,D,this),r(window,G,function(){e.refresh()}),this.opts.loop&&this._cloneElement(),c&&c(),this.refresh()}return a.prototype={handleEvent:function(a){switch(a.type){case D:return this._touchStart(a);case E:return this._touchMove(a);case F:return this._touchEnd(a);case"click":return this._click(a)}},refresh:function(){this.opts.setWidth&&this._setWidth(),this.maxPoint=this.opts.maxPoint?this.opts.maxPoint:o(this.el)-1,this.distance=this.opts.distance?this.opts.distance:this.maxPoint<0?0:p(n(this.el),!0),this.maxX=-this.distance*this.maxPoint,this.moveToPoint()},hasPrev:function(){return this.currentPoint>0},hasNext:function(){return this.currentPoint<this.maxPoint},toPrev:function(){this.hasPrev()&&this.moveToPoint(this.currentPoint-1)},toNext:function(){this.hasNext()&&this.moveToPoint(this.currentPoint+1)},moveToPoint:function(a,d){var e,f;a=a===c?this.currentPoint:a,d=d===c?this.opts.transition.duration:d,e=this.currentPoint,this.currentPoint=0>a?0:a>this.maxPoint?this.maxPoint:parseInt(a,10),f=this.visibleSize<this.beforeChildElementCount?this.beforeChildElementCount:this.visibleSize,B.cssAnimation?i(this.el,{transitionDuration:d}):this.useJsAnimate=!0,this._setX(-this.currentPoint*this.distance,d),e!==this.currentPoint&&(t(b,"flpointmove",!0,!1),this.opts.loop&&this._loop())},startAutoPlay:function(){var a=this,b=this.opts.interval;this.opts.autoPlay&&(this.timerId=setInterval(function(){a.toNext()},b))},clearAutoPlay:function(){this.timeId&&clearInterval(this.timerId)},destroy:function(){this.opts.autoPlay&&this.clearAutoPlay(),s(this.el,D,this)},_touchStart:function(a){this.opts.disableTouch||(r(this.el,E,this),r(b,F,this),B.touchEvent||a.preventDefault(),B.cssAnimation?i(this.el,{transitionDuration:"0ms"}):this.useJsAnimate=!1,this.scrolling=!0,this.moveReady=!1,this.startPageX=k(a,"pageX"),this.startPageY=k(a,"pageY"),this.basePageX=this.startPageX,this.directionX=0,t(this.el,"fltouchstart",!0,!1))},_touchMove:function(a){if(this.scrolling){var b,c,d,e,f,g=k(a,"pageX"),h=k(a,"pageY");this.opts.autoPlay&&this.clearAutoPlay(),this.moveReady?(a.preventDefault(),a.stopPropagation(),d=g-this.basePageX,e=this.currentX+d,(e>=0||e<this.maxX)&&(e=Math.round(this.currentX+d/3)),this.directionX=0===d?this.directionX:d>0?-1:1,f=!t(this.el,"fltouchmove",!0,!0),f?this._setX(e):this._setX(e)):(b=Math.abs(g-this.startPageX),c=Math.abs(h-this.startPageY),b>5?(a.preventDefault(),a.stopPropagation(),this.moveReady=!0,r(this.el,"click",this,!0)):c>5&&(this.scrolling=!1)),this.basePageX=g,this.opts.autoPlay&&this.startAutoPlay()}},_touchEnd:function(){var a;s(this.el,E,this),s(b,F,this),this.scrolling&&(a=-this.currentX/this.distance,a=this.directionX>0?Math.ceil(a):this.directionX<0?Math.floor(a):Math.round(a),0>a?a=0:a>this.maxPoint&&(a=this.maxPoint),this._touchAfter(),this.moveToPoint(a))},_click:function(a){a.stopPropagation(),a.preventDefault()},_touchAfter:function(){var a=this;this.scrolling=!1,this.moveReady=!1,setTimeout(function(){s(a.el,"click",a,!0)},200),t(this.el,"fltouchend",!0,!1)},_setX:function(a,b){a=parseInt(a,10),b=b||this.opts.duration,this.currentX=a,B.cssAnimation&&!C.isLegacy?this.el.style[A.transform]=j(a):this.useJsAnimate?this._animate(a,b):this.el.style.left=a+"px"},_setWidth:function(a){var b=a||p(n(this.el),!0),c=o(this.el);this.el.style.width=b*c+"px"},_cloneElement:function(){function a(a,b){var c=f[a],d=f[f.length-b];d&&c&&(e.el.insertBefore(d.cloneNode(!0),f[0]),e.el.appendChild(c.cloneNode(!0)))}var b,c,d,e=this,f=m(this.el),g=p(f[0],!0),h=this.el.parentNode.offsetWidth;for(this.visibleSize=Math.round(h/g)+1,b=this.beforeChildElementCount<this.visibleSize?this.beforeChildElementCount:this.visibleSize,c=0,d=b;d;c++,d--)a(c,d);this.afterChildElementCount=o(this.el),this.opts.defaultPoint||(this.currentPoint=b)},_loop:function(){function a(){c.currentPoint<h?c.moveToPoint(c.currentPoint+c.beforeChildElementCount,0):c.currentPoint>c.maxPoint-h&&c.moveToPoint(c.currentPoint-c.beforeChildElementCount,0)}var b,c=this,d=(this.visibleSize,this.opts.clearInterval),f=(o(this.el),q()),g=f.length,h=this.visibleSize<this.beforeChildElementCount?this.visibleSize:this.beforeChildElementCount;g?e(f,function(b){r(c.el,b,a),setTimeout(function(){s(c.el,b,a)},d)}):(b=a,clearTimeout(function(){a()},d))},_animate:function(a,b){var c=this,d=+new Date,e=parseInt(c.el.style.left,10),f=a,g=parseInt(b,10),h=function(a,b){return-(a/=b)*(a-2)},i=setInterval(function(){var a,b,j=new Date-d;j>g?(clearInterval(i),b=f):(a=h(j,g),b=a*(f-e)+e),c.el.style.left=b+"px"},10)}},a}(),a[x]=a[x]||w}(this,this.document);