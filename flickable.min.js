// Flickable 0.0.1 Copyright (c) 2013 Yuya Hashimoto
// See http://github.com/yhmt/flickable
!function(a,b,c){function d(a){for(var b=[],c=Object.keys(a),d=0,e=c.length;e;d++,e--)b.push(c[d]);return b}function e(a){var b=Object.prototype.toString.call(a);return"[object NodeList]"===b||"[object HTMLCollection]"===b}function f(a,b){for(var c=0,d=a.length;d;c++,d--)b.call(a[c],c)}function g(a){return a instanceof Array?(f(a,function(a){return t.style[a]!==c?!0:void 0}),!1):"string"==typeof a?t.style[a]!==c?!0:!1:void 0}function h(a,b){function e(a,b,d){var e=v[b];if(e)a[e]=d;else{if(a[b]===c)return f(u,function(e){var f=q(e)+q(b);return a[f]!==c?(v[b]=f,a[f]=d,!0):void 0}),!1;v[b]=b,a[b]=d}}var g=a.style,h=d(b);!function(a,c){for(;c;a++,c--)e(g,h[a],b[h[a]])}(0,h.length)}function i(a){return w.transform3d?"translate3d("+a+"px, 0, 0)":"translate("+a+"px, 0)"}function j(a,b){return a.changedTouches?a.changedTouches[0][b]:a[b]}function k(a,b){var c=[],d=a.childNodes;return v.childElement||(f(d,function(a){1===a.nodeType&&c.push(a)}),v.childElement=c),b?b():v.childElement}function l(a){return a.firstElementChild?a.firstElementChild:k(a,function(){return v.childElement[0]})}function m(a){return a.childElementCount?a.childElementCount:k(a,function(){return v.childElement.length})}function n(b){function d(a){var b=0;return f(a,function(a){k[a]&&(b+=parseFloat(a.match(/\d+/)[0]))}),b}var e,g,h,i,j,k=b.currentStyle||a.getComputedStyle(b,null),l=function(){var a=["-webkit-box-sizing","-moz-box-sizing","-o-box-sizing","-ms-box-sizing","box-sizing"];return f(a,function(a){return b.style[a]!==c?(e=k.prop,!0):void 0}),!1}();return l||"content-box"!==e?(g=d("margin-right","margin-left"),j=b.scrollWidth+g):(g=d("margin-right","margin-left"),h=d("padding-right","padding-left"),i=d("border-right-width","border-left-width"),j=b.scrollWidth+g+h+i),j}function o(){var a=["webkitTransitionEnd","mozTransitionEnd","oTransitionEnd","transitionend"],b="msie"!==x.browser?x.browser:x.version.browser>10?"oldie":"ie";switch(b){case"webkit":return[a[0],a[3]];case"firefox":return[a[1],a[3]];case"opera":return[a[2],a[3]];case"ie":return[a[3]];default:return[]}}function p(a,c,d,e){var f;w.createEvent?(f=b.createEvent("Event"),f.initEvent(c,d,e),a.dispatchEvent(f)):(f=b.createEventObject(),a.fireEvent(c,f))}function q(a){return a[0].toUpperCase()+a.substring(1,a.length)}var r,s="Flickable",t=b.createElement("div"),u=["webkit","moz","o","ms"],v={},w=function(){var c=g(["perspectiveProperty","WebkitPerspective","MozPerspective","msPerspective","OPerspective"]),d=g(["transformProperty","WebkitTransform","MozTransform","msTransform","OTransform"]),e=g(["transitionProperty","WebkitTransitionProperty","MozTransitionProperty","msTransitionProperty","OTransitionProperty"]);return{touchEvent:"ontouchstart"in a,addEventListener:"addEventListener"in a,removeEventListener:"removeEventListener"in a,createEvent:"createEvent"in b,transform3d:c,transform:d,cssAnimation:(c||d)&&e?!0:!1}}(),x=function(){var a=navigator.userAgent.toLowerCase(),b=a.match(/(?:iphone\sos|ip[oa]d.*os)\s([\d_]+)/),c=a.match(/(android)\s+([\d.]+)/),d=!!b,e=!!c,f=function(){var b=/(webkit)[ \/]([\w.]+)/.exec(a)||/(firefox)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||[];return{name:b[1],version:parseFloat(b[2])}}(),g=function(){return w.touchEvent?d?"ios":"android":"desktop"}(),h=function(){return"desktop"!==g?parseFloat((b||c).pop().split(/\D/).join(".")):null}();return{platform:g,browser:f.name,version:{os:h,browser:f.version},isLegacy:e&&3>h||"msie"===f.name&&f.version<10}}(),y=w.touch?"touchstart":"mousedown",z=w.touch?"touchmove":"mousemove",A=w.touch?"touchend":"mouseup";Object.keys||(Object.keys=function(a){var b,c=[],d=0;for(b in a)a.hasOwnProperty(b)&&(c[d++]=b);return c}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),r=function(){function a(a,b){return this.el=a,this.opts=b||{},this.opts.autoPlay=this.otps.autoPlay||!1,this.opts.loop=this.otps.loop||(this.opts.autoPlay?!0:!1),this.opts.interval=this.opts.interval||6600,this.opts.clearInterval=this.opts.clearInterval||this.opts.interval/2,this.opts.transition=this.opts.transition||{duration:x.isLegacy?"200ms":"330ms",timingFunction:"cubic-bezier(0.23, 1, 0.32, 1)"},this.distance=this.opts.distance||0,this.currentPoint=this.opts.currentPoint||0,this.maxPoint=this.maxX=this.currentX=this.startPageX=this.startPageY=this.basePageX=this.directionX=this.visibleSize=0,this.timeId=null,this.scrolling=this.moveReady=this.useJsAnimate=!1,this}function c(c,d,f){var g,h,i=/^(.+[\#\.\s\[\*>:,]|[\[:])/;return"string"==typeof c?(h=c.substring(1,c.length),g=i.test(c)?b.querySelector(c):"#"===c[0]?b.getElementById(h):"."===c[0]?b.getElementsByClassName(h)[0]:b.getElementsByTagName(c)[0]):(e(c)||"object"==typeof c&&c.length||Array.isArray(c)&&c.length&&c[0].nodeType)&&(g=c[0]),new a(g,d,f)}return a.prototype={handleEvent:function(a){switch(a.type){case y:this._touchStart(a);break;case z:this._touchMove(a);break;case A:this._touchEnd(a);break;case"click":this._click(a)}},refresh:function(){},hasPrev:function(){return this.currentPoint>0},hasNext:function(){return this.currentPoint<this.maxPoint},toPrev:function(){this.hasPrev()&&this.moveToPoint(this.currentPoint-1)},toNext:function(){this.hasNext()&&this.moveToPoint(this.currentPoint+1)},moveToPoint:function(a,b){a=a||this.currentPoint,b=b||this.option.transition.duration;var c=this.currentPoint;this.currentPoint=0>a?0:a>this.maxPoint?this.maxPoint:parseInt(a,10),this._setX(-(this.currentPoint*this.distance),b),c!==this.currentPoint&&(p(this.el,"flpointmove",!0,!1),this.opts.loop&&this._loop())},startAutoPlay:function(){var a,b=this.opts.interval;this.opts.autoPlay&&(this.timerId=setInterval(function(){a.toNext()},b))},clearAutoPlay:function(){this.timeId&&clearInterval(this.timerId)},destroy:function(){this.opts.autoPlay&&this.clearAutoPlay(),this._off(y,this)},_touchStart:function(a){return this.scrolling=!0,this.moveReady=!1,this.startPageX=j(a,"pageX"),this.startPageY=j(a,"pageY"),this.basePageX=this.startPageX,this.directionX=0,this._on(z,this,!1),w.touchEvent||a.preventDefault(),w.cssAnimation?h(this.el,{transitionDuration:"0ms"}):this.useJsAnimate=!1},_touchMove:function(a){var b,c,d,e,f=j(a,"pageX"),g=j(a,"pageY");this.opts.autoPlay&&this.clearAutoPlay(),this.moveReady?(a.preventDefault(),a.stopPropagation(),d=f-this.basePageX,e=this.currentX+d,(e>=0||e<this.maxX)&&(e=Math.round(this.currentX+d/3)),this._setX(e),this.directionX=0===d?this.directionX:d>0?-1:1):(b=Math.abs(f-this.startPageX),c=Math.abs(g-this.startPageY),b>5?(a.preventDefault(),a.stopPropagation(),this.moveReady=!0,this._on("click",this,!0)):c>5&&(this.scrolling=!1)),this.basePageX=f,this.opts.autoPlay&&this.startAutoPlay()},_touchEnd:function(){var a,b=this;this._off(z,this),this.scrolling&&(a=-this.currentX/this.distance,a=this.directionX>0?Math.ceil(a):this.directionX<0?Math.floor(a):Math.round(a),this.moveToPoint(a),setTimeout(function(){b._off("click",b)},200))},_click:function(a){a.stopPropagation(),a.preventDefault()},_on:function(a,b,c){return c=c||!1,w.addEventListener?this.el.addEventListener(a,b,c):this.el.attachEvent("on"+a,b)},_off:function(a,b){return w.removeEventListener?this.el.removeEventListener(a,b):this.el.detachEvent("on"+a,b)},_loop:function(){function a(){return c?b.moveToPoint(b.currentPoint+g,0):b.moveToPoint(b.currentPoint-g,0)}var b,c=this.currentPoint<=this.visibleSize,d=this.currentPoint>=this.maxPoint-this.visibleSize,e=this.opts.clearInterval,g=m(this.el),h=o(),i=h.length;(i&&c||d)&&f(h,function(c){b._on(c,a,!1),setTimeout(function(){b._off(c,a)},e)})},_setX:function(a,b){return a=parseInt(a,10),b=b||this.opts.duration,this.currentX=a,w.cssAnimation?x.isLegacy?this.el.style.left=a+"px":h(this.el,{transform:i(a)}):(this._jsAnimate(a,b),void 0)},_setWidth:function(a){var b=a||n(l(this.el)),c=m(this.el);this.el.style.width=b*c+"px"},_cloneElement:function(){function a(a,d){var e=c[a],f=c[c.length-d];b.el.insertBefore(f.cloneNode(!0),c[0]),b.el.appendChild(e.cloneNode(!0))}var b=this,c=k(this.el),d=n(c[0]),e=n(this.el.parentNode);return this.visibleSize=parseInt(e/d,10)+1,function(c,d){for(;d;c++,c--)a(c,b.visibleSize-c);b.currentPoint=b.visibleSize}(0,this.visibleSize)}},c}(),a[s]=a[s]||r}(this,this.document);